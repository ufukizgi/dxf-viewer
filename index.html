<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DXF Viewer - Professional CAD Viewer</title>
    <!-- Locallized Libraries -->
    <script>
        // Suppress Tailwind CSS production warning for local offline usage
        const originalWarn = console.warn;
        console.warn = function (...args) {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('should not be used in production')) return;
            originalWarn.apply(console, args);
        };
    </script>
    <script src="./libs/tailwindcss.js"></script>
    <script src="./libs/occt-import-js.js"></script>

    <link rel="stylesheet" href="styles.css">

    <!-- Fonts: Using system fonts fallback for offline capability -->
    <style>
        /* Fallback to system fonts if Inter is not available offline */
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
    <!-- 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    -->


    <!-- Buffer Polyfill for DXF Parser -->
    <script src="./libs/buffer.js"></script>
    <script>
        // Expose Buffer globally for libraries that need it (like dxf-parser)
        if (typeof window.Buffer === 'undefined') {
            if (window.buffer && window.buffer.Buffer) {
                window.Buffer = window.buffer.Buffer;
            } else {
                console.warn('Buffer library loaded but window.buffer.Buffer not found');
            }
        }
    </script>

    <script type="importmap">
        {
            "imports": {
                "three": "./libs/three/three.module.js",
                "three/addons/": "./libs/three/addons/",
                "dxf-parser": "./libs/dxf-parser.js", 
                "dxf-json": "./libs/dxf-parser.js" 
            }
        }
    </script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="file-upload-container relative group">
                    <button class="file-open-btn" id="open-file-btn" title="Open File" data-i18n-title="openFile">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
                                stroke-width="2" />
                        </svg>
                    </button>
                    <!-- Open File Dropdown -->
                    <div id="file-dropdown"
                        class="hidden absolute top-full left-0 mt-2 min-w-[180px] bg-gray-900/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl z-[1001] flex flex-col gap-1 p-1.5">
                        <button id="menu-new-file"
                            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition-colors text-left text-white text-sm">
                            <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span data-i18n="newFile">New File</span>
                        </button>
                        <label for="file-input"
                            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition-colors text-left text-white text-sm cursor-pointer">
                            <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                            <span data-i18n="uploadFile">Upload File</span>
                        </label>
                        <button id="menu-templates"
                            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition-colors text-left text-white text-sm">
                            <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                            </svg>
                            <span data-i18n="templates">Templates</span>
                        </button>
                    </div>
                    <input type="file" id="file-input"
                        accept=".dxf,.dwg,.pdf,.stp,.step,.iges,.igs,.stl,.obj,.gltf,.glb" hidden>
                </div>

                <!-- Download Button -->
                <button class="icon-btn tool-btn ml-2 disabled:opacity-30 disabled:cursor-not-allowed" id="download-btn"
                    title="Download DXF" data-i18n-title="downloadDxf" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <path d="M7 10l5 5 5-5" />
                        <path d="M12 15V3" />
                    </svg>
                </button>

                <!-- Print Button (Moved) -->
                <button class="icon-btn tool-btn ml-2 disabled:opacity-30 disabled:cursor-not-allowed" id="print-btn"
                    title="Print" data-i18n-title="print" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9V2h12v7" />
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
                        <rect x="6" y="14" width="12" height="8" />
                    </svg>
                </button>

                <div class="h-6 w-px bg-white/10 mx-2"></div>

                <!-- Undo/Redo -->
                <button class="icon-btn tool-btn disabled:opacity-30 disabled:cursor-not-allowed" id="undo-btn"
                    title="Undo" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 7v6h6" />
                        <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" />
                    </svg>
                </button>
                <button class="icon-btn tool-btn disabled:opacity-30 disabled:cursor-not-allowed" id="redo-btn"
                    title="Redo" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 7v6h-6" />
                        <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7" />
                    </svg>
                </button>
            </div>

            <!-- Loader Overlay -->
            <div id="conversion-loader"
                class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] hidden flex flex-col items-center justify-center">
                <div class="loader-spinner mb-4"></div>
                <div class="text-white text-lg font-medium animate-pulse" data-i18n="converting">DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼yor...</div>
            </div>

            <div class="header-center">
                <div class="header-tools flex items-center gap-1">
                    <!-- Measurement Tools (Unwrapped) -->

                    <!-- Linear -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="tool-distance" title="Linear Measurement" data-i18n-title="measureDistance"
                        data-tool="distance" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M1 3 V21" />
                            <path d="M23 3 V21" />
                            <path d="M8 8 L3 12 L8 16" />
                            <path d="M16 8 L21 12 L16 16" />
                            <path d="M3 12 H21" />
                        </svg>
                    </button>

                    <!-- Angle -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="tool-angle" title="Angle Measurement" data-i18n-title="measureAngle" data-tool="angle"
                        disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18 3 L3 22 L22 22" />
                            <path d="M9 14 A5 5 30 0 1 12 22" fill="none" />
                        </svg>
                    </button>

                    <!-- Radius -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="tool-radius" title="Radius Measurement" data-i18n-title="measureRadius" data-tool="radius"
                        disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="12" x2="22" y2="12" />
                            <text x="14" y="10" font-size="8" fill="white" stroke="none">R</text>
                        </svg>
                    </button>

                    <!-- Diameter -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="tool-diameter" title="Diameter Measurement" data-i18n-title="measureDiameter"
                        data-tool="diameter" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="2" y1="12" x2="22" y2="12" />
                            <path d="M4 10 L2 12 L4 14" />
                            <path d="M20 10 L22 12 L20 14" />
                            <text x="11" y="10" font-size="8" fill="white" stroke="none">Ã˜</text>
                        </svg>
                    </button>

                    <div class="h-6 w-px bg-white/10 mx-2"></div>

                    <!-- Weight Calculation -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="weight-btn" title="Calculate Weight" data-i18n-title="weightBtn" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23" />
                            <line x1="5" y1="3.5" x2="19" y2="3.5" />
                            <line x1="5" y1="3.5" x2="1" y2="15" />
                            <line x1="5" y1="3.5" x2="9" y2="15" />
                            <line x1="19" y1="3.5" x2="23" y2="15" />
                            <line x1="19" y1="3.5" x2="15" y2="15" />
                            <line x1="6" y1="23" x2="18" y2="23" />
                            <line x1="1" y1="15" x2="9" y2="15" />
                            <line x1="15" y1="15" x2="23" y2="15" />
                        </svg>
                    </button>

                    <!-- Scale Button (New) -->
                    <button class="icon-btn tool-btn disabled:opacity-50 disabled:cursor-not-allowed group-is-disabled"
                        id="scale-btn" title="Scale Objects" data-i18n-title="scaleBtn" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                            stroke="currentColor" stroke-linecap="round" stroke-width="1.5" fill="none">
                            <rect width="10" height="10" x="1" y="12" stroke-opacity="0.8" rx="0.25" ry="0.25" />
                            <line x1="5" y1="11" x2="5" y2="1" />
                            <line x1="5" y1="1" x2="23" y2="1" />
                            <line x1="23" y1="1" x2="23" y2="18" />
                            <line x1="23" y1="18" x2="12" y2="18" />
                        </svg>
                    </button>
                </div>

                <!-- Layers Dropdown (Refactored) -->
                <div class="relative layers-container ml-4 border-l border-white/10 pl-4 flex items-center gap-2 group"
                    id="layers-group">
                    <button class="icon-btn tool-btn" title="Layers" data-i18n-title="layers">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-width="2" />
                        </svg>
                    </button>

                    <!-- Dropdown Wrapper (Width Fixed for layout) -->
                    <div class="relative w-[180px] h-9 group z-50">
                        <!-- Simplified Menu (Collapses to Single Line, Expands on Hover) -->
                        <div id="layers-menu"
                            class="absolute top-0 right-0 w-full bg-gray-900/90 backdrop-blur-md border border-white/10 rounded-lg shadow-xl overflow-hidden h-9 transition-[height] duration-300 ease-in-out group-hover:h-auto group-hover:bg-gray-900/95"
                            style="min-width: 100%;">

                            <!-- Header Section (Always Visible) -->
                            <div
                                class="h-9 px-3 flex items-center justify-between cursor-pointer border-b border-transparent group-hover:border-white/10 select-none">
                                <div class="flex items-center gap-2 flex-1 min-w-0">
                                    <div id="layer-header-color" class="w-3 h-3 rounded-sm border border-white/20"
                                        style="background-color: white;"></div>
                                    <span id="layer-header-name"
                                        class="text-xs text-gray-200 font-medium truncate">0</span>
                                </div>

                                <div class="flex items-center gap-2 pl-2">
                                    <div id="layer-header-visible"
                                        class="text-gray-400 hover:text-white flex items-center justify-center">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                            <circle cx="12" cy="12" r="3" />
                                        </svg>
                                    </div>
                                    <svg class="w-3 h-3 text-gray-500 group-hover:rotate-180 transition-transform"
                                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                            </div>

                            <!-- List Content (Visible on Expand) -->
                            <div id="layers-panel" class="p-2 space-y-1 max-h-[400px] overflow-y-auto custom-scrollbar">
                                <p class="empty-state text-xs text-center py-2 text-gray-500">No layers</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-right flex items-center gap-3">
                <div class="relative group" id="zoom-dropdown-container">
                    <button class="icon-btn tool-btn" id="zoom-menu-btn" title="Zoom Tools"
                        data-i18n-title="zoomExtents">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    <!-- Dropdown Menu -->
                    <div class="hidden absolute top-full left-0 mt-2 p-1.5 rounded-xl bg-gray-900/95 backdrop-blur-xl border border-white/10 shadow-2xl min-w-[160px] flex flex-col gap-1 z-50"
                        id="zoom-dropdown-menu">

                        <!-- Zoom Extents -->
                        <button
                            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition-colors text-left"
                            id="zoom-extents-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
                            </svg>
                            <span class="text-sm font-medium text-white" data-i18n="zoomExtents">Fit View</span>
                        </button>

                        <!-- Zoom Window -->
                        <button
                            class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5 transition-colors text-left"
                            id="zoom-window-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                <rect x="8" y="8" width="6" height="6" stroke-dasharray="2 2" stroke-width="1"></rect>
                            </svg>
                            <span class="text-sm font-medium text-white" data-i18n="zoomWindow">Zoom Window</span>
                        </button>
                    </div>
                </div>





                <div id="language-selector-container" class="relative"></div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header flex justify-between items-center mb-4 px-1">
                    <h3 class="text-sm font-semibold text-white" data-i18n="sidebarTitle">Sidebar</h3>
                    <button id="sidebar-close-btn"
                        class="p-1 rounded-md hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                        title="Close Sidebar" data-i18n-title="closeSidebar">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
                <!-- Layers moved to Header -->

                <!-- Object Info / Measurement Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M17 3l4 4L7 21l-4-4L17 3z" stroke-width="2" />
                        </svg>
                        <h3 data-i18n="objectInfo">Object Info</h3>
                    </div>
                    <div class="panel-content" id="measurement-panel">
                        <!-- Tools moved to header -->
                        <div id="measurement-result" class="measurement-result">
                            <p class="empty-state" data-i18n="clickObjectInfo">Click an object to view info</p>
                        </div>
                    </div>
                </div>

                <!-- Gap Tolerance Panel (New) -->
                <div id="gap-tolerance-panel" class="panel mt-4 hidden">
                    <div class="panel-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 21v-7" />
                            <path d="M20 21v-7" />
                            <path d="M12 21v-7" />
                            <path d="M2 10l10-7 10 7" />
                        </svg>
                        <h3 data-i18n="gapTolerance">Gap Tolerance</h3>
                    </div>
                    <div class="panel-content p-3">
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-3 flex justify-between items-center border border-white/5">
                            <span class="text-gray-200 font-medium text-sm" data-i18n="tolerance">Tolerance (mm)</span>
                            <div class="relative w-24">
                                <input type="number" id="gap-tolerance-input" value="0.01" step="0.01" min="0.001"
                                    max="10"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors font-mono appearance-none" />
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 text-center" data-i18n="toleranceHint">
                            Increase for PDF/Scanned files with gaps.
                        </p>
                    </div>
                </div>

                <!-- Weight Calculation Panel (shows only when closed geometry is selected) -->
                <div id="weight-panel" class="panel flex-1 min-h-0 flex flex-col mt-4 hidden">
                    <div class="panel-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.9 19.1L4.1 19c-1 0-1.7.9-1.5 1.9L2.9 22H21l.4-1.1c.1-1-.6-1.8-1.5-1.8z" />
                            <path d="M16 11l-4-7-4 7" />
                            <path d="M12 4v15" />
                        </svg>
                        <h3 data-i18n="weightTitle">Weight Calculation</h3>
                    </div>
                    <div class="panel-content flex-1 overflow-y-auto p-2 space-y-2">
                        <!-- Material Selector -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium whitespace-nowrap mr-2"
                                data-i18n="material">Material</span>
                            <div class="relative flex-1 max-w-[65%]">
                                <select id="material-selector"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors cursor-pointer appearance-none pr-6 font-mono">
                                    <!-- Options will be populated by JS -->
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-1 pointer-events-none text-gray-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Temper Selector -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium whitespace-nowrap mr-2"
                                data-i18n="temper">Temper</span>
                            <div class="relative flex-1 max-w-[65%]">
                                <select id="temper-selector"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors cursor-pointer appearance-none pr-6 font-mono">
                                    <!-- Options will be populated by JS -->
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-1 pointer-events-none text-gray-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Pres Selector -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium whitespace-nowrap mr-2">Pres</span>
                            <div class="relative flex-1 max-w-[65%]">
                                <select id="pres-selector"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors cursor-pointer appearance-none pr-6 font-mono">
                                    <!-- Populated by JS -->
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-1 pointer-events-none text-gray-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Figur Selector -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium whitespace-nowrap mr-2">FigÃ¼r</span>
                            <div class="relative flex-1 max-w-[65%]">
                                <select id="figur-selector"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors cursor-pointer appearance-none pr-6 font-mono">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                                <div
                                    class="absolute inset-y-0 right-0 flex items-center px-1 pointer-events-none text-gray-400">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Extrusion Ratio Display -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="extrusionRatio">Extr. Ratio</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-extrusion-ratio">0.00</span>
                            </div>
                        </div>

                        <hr class="border-white/10 mt-3">

                        <!-- Mandrel -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="mandrel">ZÄ±vana (Mandrel)</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-mandrel">0</span>
                            </div>
                        </div>

                        <!-- Area -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="area">Net Area</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-area">0.00</span>
                                <span class="text-xs text-gray-500 ml-1" data-i18n="unitMm2">mmÂ²</span>
                            </div>
                        </div>

                        <!-- Weight -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="weight">Weight</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-weight">0.000</span>
                                <span class="text-xs text-gray-500 ml-1" data-i18n="unitKgM">kg/m</span>
                            </div>
                        </div>

                        <!-- Bounding Circle Diameter -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium">DU (Ã˜)</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-diameter">0.00</span>
                                <span class="text-xs text-gray-500 ml-1">mm</span>
                            </div>
                        </div>

                        <!-- Outer Perimeter -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="outerPerimeter">DÄ±ÅŸ Ã‡evre</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-perimeter">0.00</span>
                                <span class="text-xs text-gray-500 ml-1">mm</span>
                            </div>
                        </div>

                        <!-- Shape Factor -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="shapeFactor">Åžekil FaktÃ¶rÃ¼</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-shapefactor">0.00</span>
                            </div>
                        </div>

                        <!-- Total Perimeter -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-1 flex justify-between items-center mt-2 border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="totalPerimeter">Toplam Ã‡evre</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono" id="val-totalperimeter">0.00</span>
                                <span class="text-xs text-gray-500 ml-1">mm</span>
                            </div>
                        </div>
                    </div>


                </div>

                <!-- Scale Display Panel (shows during template placement mode) -->
                <div id="scale-panel" class="panel flex-1 min-h-0 flex flex-col mt-4 hidden">
                    <div class="panel-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 3L3 21" />
                            <path d="M21 3h-6m6 0v6" />
                            <path d="M3 21h6m-6 0v-6" />
                        </svg>
                        <h3 data-i18n="scale">Ã–lÃ§ek</h3>
                    </div>
                    <div class="panel-content flex-1 overflow-y-auto p-3 space-y-4">
                        <div class="text-left text-gray-400 text-sm mb-4">
                            <div data-i18n="scrollToScale">ðŸ¡• Ã–lÃ§eklemek iÃ§in scroll kullanÄ±n</div>
                            <div data-i18n="scrollToRotate">â†» DÃ¶ndÃ¼rmek iÃ§in Ctrl + Scroll kullanÄ±n</div>
                            <div data-i18n="clickToPlace">ðŸŸ‚ YerleÅŸtirmek iÃ§in tÄ±klayÄ±n</div>
                        </div>

                        <!-- Template Scale -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-3 flex justify-between items-center border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="templateScale">Åžablon Ã–lÃ§eÄŸi</span>
                            <div class="text-right">
                                <span class="text-cyan-400 font-mono text-xl" id="val-scale">1:1</span>
                            </div>
                        </div>

                        <!-- Template Rotation -->
                        <div
                            class="bg-gradient-to-l from-white/10 to-transparent rounded-lg p-3 flex justify-between items-center border border-white/5">
                            <span class="text-gray-200 font-medium" data-i18n="templateRotation">DÃ¶ndÃ¼rme</span>
                            <div class="relative w-24">
                                <input type="number" id="input-rotation" value="0.00" step="0.01" min="0" max="360"
                                    class="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-right text-sm text-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors font-mono appearance-none" />
                                <span
                                    class="absolute right-8 top-1/2 -translate-y-1/2 text-xs text-gray-500 pointer-events-none">Â°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Center Column: Tab Bar + Viewport -->
            <div id="center-column" class="flex flex-col flex-1 relative min-w-0">
                <!-- Tab Bar Container -->
                <div id="tab-bar-container" class="tab-bar">
                    <!-- Left Sidebar Toggle -->
                    <button id="sidebar-toggle-btn" class="icon-btn tab-bar-btn hidden" title="Show Sidebar"
                        data-i18n-title="showSidebar">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M4 6h16M4 12h16m-7 6h7" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>

                    <!-- Tabs Scroll Container -->
                    <div id="tab-list" class="flex-1 flex items-center overflow-x-auto gap-1 px-1 no-scrollbar">
                        <!-- Tabs will be injected here -->
                    </div>

                    <!-- Clipboard Toggle -->
                    <button id="clipboard-toggle-btn" class="icon-btn tab-bar-btn" title="Show Clipboard"
                        data-i18n-title="showClipboard">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                                stroke-width="2"></path>
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" stroke-width="2"></rect>
                        </svg>
                    </button>
                </div>

                <!-- Viewport -->
                <main class="viewport-container flex-1 relative" id="viewport-container">
                    <canvas id="viewport" class="viewport-canvas"></canvas>
                    <div class="overlay-logo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M3 3h18v18H3z M3 9h18 M9 3v18" stroke-width="2" />
                        </svg>
                        <h1 data-i18n="appTitle">DXF Viewer</h1>
                    </div>

                    <!-- Start Page (Welcome Screen) -->
                    <div id="start-page"
                        class="absolute inset-0 bg-gray-900 z-10 flex items-center justify-center hidden">
                        <div class="max-w-4xl w-full px-6 flex flex-col items-center">
                            <div class="mb-12 text-center">
                                <div class="flex items-center justify-center gap-4 mb-4">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" class="text-cyan-400"
                                        stroke="currentColor" stroke-width="1.5">
                                        <path d="M3 3h18v18H3z M3 9h18 M9 3v18" />
                                    </svg>
                                    <h1 class="text-5xl font-bold text-white tracking-tight">DXF Viewer</h1>
                                </div>
                                <p class="text-gray-400 text-lg" data-i18n="appSubtitle">Professional CAD functionality
                                    in
                                    your browser</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                                <!-- New File Card -->
                                <button id="start-new-file"
                                    class="group relative p-8 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-cyan-500/50 hover:shadow-2xl hover:shadow-cyan-500/10 transition-all duration-300 flex flex-col items-center gap-4 text-center">
                                    <div
                                        class="w-16 h-16 rounded-full bg-cyan-500/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                        <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-white mb-2" data-i18n="newFile">New File
                                        </h3>
                                        <p class="text-sm text-gray-400" data-i18n="newFileDesc">Create a clean, empty
                                            workspace</p>
                                    </div>
                                </button>

                                <!-- Upload File Card -->
                                <label for="file-input"
                                    class="cursor-pointer group relative p-8 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-yellow-500/50 hover:shadow-2xl hover:shadow-yellow-500/10 transition-all duration-300 flex flex-col items-center gap-4 text-center">
                                    <div
                                        class="w-16 h-16 rounded-full bg-yellow-500/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                        <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-white mb-2" data-i18n="uploadFile">Open
                                            File
                                        </h3>
                                        <p class="text-sm text-gray-400" data-i18n="uploadFileDesc">Open DXF, DWG, PDF,
                                            STP, STL, OBJ...</p>
                                    </div>
                                </label>

                                <!-- Templates Card -->
                                <button id="start-templates"
                                    class="group relative p-8 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-purple-500/50 hover:shadow-2xl hover:shadow-purple-500/10 transition-all duration-300 flex flex-col items-center gap-4 text-center">
                                    <div
                                        class="w-16 h-16 rounded-full bg-purple-500/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                        <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-white mb-2" data-i18n="templates">
                                            Templates
                                        </h3>
                                        <p class="text-sm text-gray-400" data-i18n="templatesDesc">Start from a
                                            pre-defined
                                            template</p>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Selection Box -->
                    <div id="selection-box" class="selection-box hidden"></div>
                </main>
            </div>

            <!-- Clipboard Sidebar (Right) -->
            <aside class="clipboard-sidebar collapsed" id="clipboard-sidebar">
                <div class="sidebar-header flex justify-between items-center mb-4 px-1">
                    <h3 class="text-sm font-semibold text-white" data-i18n="clipboardTitle">Pano</h3>
                    <button id="clipboard-close-btn"
                        class="p-1 rounded-md hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                        title="Close Clipboard" data-i18n-title="closeClipboard">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>

                <div class="panel flex-1 flex flex-col min-h-0">
                    <div class="panel-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                                stroke-width="2" />
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" stroke-width="2" />
                        </svg>
                        <h3 data-i18n="clipboardTitle">Pano</h3>
                    </div>
                    <div class="panel-content flex-1 overflow-y-auto p-2" id="clipboard-list">
                        <!-- Items will be injected here -->
                    </div>
                    <div class="p-2 border-t border-white/10">
                        <button id="clipboard-clear-btn"
                            class="w-full py-1 text-xs text-red-400 hover:text-red-300 transition-colors uppercase font-medium tracking-wide"
                            data-i18n="clearAll">
                            Clear All
                        </button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Footer with OSNAP Dropdown -->
        <footer class="footer">
            <div class="footer-left">
                <span id="cursor-coords" class="coords">X: 0.000 | Y: 0.000</span>
            </div>
            <div class="footer-center">
                <span id="status-text" class="status" data-i18n="ready">Ready</span>
            </div>
            <div class="footer-right flex items-center gap-4">
                <span id="zoom-level" class="zoom"><span data-i18n="zoom">Zoom</span>: 100%</span>
            </div>
        </footer>
    </div>



    <!-- Template Selection Popup -->
    <div id="template-popup"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center">
        <div class="bg-gray-900/95 border border-white/10 rounded-xl shadow-2xl p-5 w-[320px]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-sm font-semibold text-white" data-i18n="selectTemplate">Antet SeÃ§</h3>
                <button id="template-popup-close" class="text-gray-400 hover:text-white transition-colors">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-400 mb-1" data-i18n="templateFile">Antet DosyasÄ±</label>
                    <select id="template-selector"
                        class="w-full bg-black/20 border border-white/10 rounded px-2 py-2 text-sm text-white focus:outline-none focus:border-blue-500 transition-colors cursor-pointer">
                        <option value="" data-i18n="loadingTemplates">YÃ¼kleniyor...</option>
                    </select>
                </div>

                <div class="flex gap-2 mt-4">
                    <button id="template-cancel-btn"
                        class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors"
                        data-i18n="cancel">Ä°ptal</button>
                    <button id="template-ok-btn"
                        class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 px-4 rounded-lg transition-colors"
                        data-i18n="ok">Tamam</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Confirmation Modal -->
    <div id="download-modal"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center">
        <div class="bg-gray-900/95 border border-white/10 rounded-xl shadow-2xl p-6 w-[400px]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-white" data-i18n="downloadConfirmTitle">Confirm Download</h3>
                <button id="download-modal-close" class="text-gray-400 hover:text-white transition-colors">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <p class="text-gray-300 text-sm leading-relaxed" data-i18n="downloadConfirmDesc">
                    You are about to download the converted DXF version of the original file.
                </p>
            </div>

            <div class="flex gap-3 justify-end">
                <button id="download-cancel-btn"
                    class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-colors text-sm"
                    data-i18n="cancel">Cancel</button>
                <button id="download-confirm-btn"
                    class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-medium transition-colors text-sm flex items-center gap-2"
                    data-i18n="downloadBtn">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <path d="M7 10l5 5 5-5" />
                        <path d="M12 15V3" />
                    </svg>
                    <span data-i18n="downloadBtn">Download</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scale Confirmation Modal (New) -->
    <div id="scale-modal"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center">
        <div class="bg-gray-900/95 border border-white/10 rounded-xl shadow-2xl p-6 w-[350px]">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-white" data-i18n="scaleTitle">Scale Objects</h3>
                <button id="scale-modal-close" class="text-gray-400 hover:text-white transition-colors">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="mb-5 space-y-4">
                <p class="text-sm text-gray-300" data-i18n="scaleFactor">Enter scale factor:</p>
                <div class="flex items-center gap-2">
                    <input type="text" id="scale-factor-input" value="1.0"
                        class="w-full bg-black/30 border border-white/10 rounded px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500 transition-colors" />
                </div>
            </div>

            <div class="flex gap-2 justify-end">
                <button id="scale-cancel-btn"
                    class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-medium transition-colors text-sm"
                    data-i18n="cancel">Cancel</button>
                <button id="scale-confirm-btn"
                    class="px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white font-medium transition-colors text-sm"
                    data-i18n="ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Modules -->
    <script type="module" src="src/dxf-loader.js"></script>
    <script type="module" src="src/localization.js"></script>
    <script type="module" src="src/main.js"></script>
</body>

</html>